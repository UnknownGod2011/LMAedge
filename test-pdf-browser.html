<!DOCTYPE html>
<html>
<head>
    <title>PDF Extraction Test</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        #results { white-space: pre-wrap; background: #f0f0f0; padding: 10px; margin-top: 20px; }
        .success { color: green; }
        .error { color: red; }
        .warning { color: orange; }
    </style>
</head>
<body>
    <h1>PDF Text Extraction Test</h1>
    <p>This tests if PDF.js can extract text from your PDF.</p>
    
    <input type="file" id="fileInput" accept=".pdf">
    <div id="results"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        const results = document.getElementById('results');
        const fileInput = document.getElementById('fileInput');

        fileInput.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            results.innerHTML = '<div>Processing...</div>';

            try {
                const arrayBuffer = await file.arrayBuffer();
                const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                
                results.innerHTML += `<div class="success">✅ PDF loaded successfully</div>`;
                results.innerHTML += `<div>Total pages: ${pdf.numPages}</div>`;
                
                let fullText = '';
                for (let i = 1; i <= Math.min(pdf.numPages, 10); i++) {
                    const page = await pdf.getPage(i);
                    const textContent = await page.getTextContent();
                    const pageText = textContent.items.map(item => item.str).join(' ');
                    fullText += pageText + '\\n\\n';
                    
                    if (i === 1) {
                        results.innerHTML += `<div>Page 1 text length: ${pageText.length} chars</div>`;
                    }
                }
                
                results.innerHTML += `<div class="success">✅ EXTRACTION COMPLETE</div>`;
                results.innerHTML += `<div><strong>Total extracted text: ${fullText.length} characters</strong></div>`;
                
                if (fullText.length < 1000) {
                    results.innerHTML += `<div class="error">❌ WARNING: Very little text extracted (${fullText.length} chars)</div>`;
                    results.innerHTML += `<div class="error">This PDF is likely scanned/image-based</div>`;
                } else {
                    results.innerHTML += `<div class="success">✅ Good amount of text extracted</div>`;
                }
                
                results.innerHTML += `<div style="margin-top: 20px;"><strong>First 2000 characters:</strong></div>`;
                results.innerHTML += `<div style="background: white; padding: 10px; border: 1px solid #ccc;">${fullText.substring(0, 2000)}</div>`;
                
                results.innerHTML += `<div style="margin-top: 20px;"><strong>Last 1000 characters:</strong></div>`;
                results.innerHTML += `<div style="background: white; padding: 10px; border: 1px solid #ccc;">${fullText.substring(fullText.length - 1000)}</div>`;
                
            } catch (error) {
                results.innerHTML += `<div class="error">❌ ERROR: ${error.message}</div>`;
                console.error(error);
            }
        });
    </script>
</body>
</html>
